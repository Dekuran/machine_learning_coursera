---
title: "Machine Learning Assignment Using Exercise Data"
author: "Declan Clowry"
date: "26 July 2015"
output: html_document
---

##Introduction & Summary
This assignment uses data from the Human Activity Recognition project (Velloso et al. 2013) using various wearable devices to track movement during exercise with weights where the participants were asked to perform exercises both correctly (classe = A) and with one of 4 common mistakes (classe = B:E )

The purpose of the assignment was to use machine learning techniques to create a model that predicts whether the exercises were performed correctly or incorrectly.

Given the large number of variables and the difficulty of comparing them all visually to find a human-generated set of predictors, a random forest model was chosen to try many different combinations of predictors and split points.

This resulted in a model with an expected out of sample error of 25%.

##Methods
First several useful packages for creating the model, plotting the results, and speeding up performance were identified and loaded:
```{r}
require(ggplot2)
require(caret)
require(curl)
require(doParallel)
registerDoParallel(cores=2)
require(randomForest)
```

Next the training data was downloaded, turned into an R object.

```{r}
## let's get the training data now
trainurl<-'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv'
download.file(trainurl,destfile="train.csv", method="curl")
train<-read.csv("train.csv" )
```

The training data was further processed and then split into training and testing sets so that the model could be pre-tested before being used on the 'real' testing data set.

```{r}
#removing the rownumbers, timestamps, window, and usernames as variables
exercise<-subset(train,select=-c(X,user_name,raw_timestamp_part_1,raw_timestamp_part_2,cvtd_timestamp,new_window,num_window))
# removing mostly NA data
few_na<-apply(!is.na(exercise),2,sum)>19621
exercise<-exercise[,few_na]
#splitting the training data into training and testing data to allow some pre-testing before using the real test set
inTrain<-createDataPartition(y=exercise$classe,p=0.7,list=F)
training<-exercise[inTrain,]
testing<-exercise[-inTrain,]
```

The random forest method was used to generate a model because it provides high accuracy and works well with non-linear results. Five-fold Cross-Validation was applied.

```{r}
modFit<-train(classe ~. , 
              data= training, 
              method="rf" ,
              trControl=trainControl(method="cv",number=5),
              prox=TRUE,
              allowParallel=TRUE)
```

We can check how accurate the model was:

```{r}
modFit$finalModel
```

Which tells us there's an OOB error of 25.46%, or that our predictions are accurate 74.54% of the time. We can test this against the internal testing dataset. A problem is that we can only compare the accuracy where a record from the testing set contained data from all the variables used to generate the model, unless we use rfImpute() to impute the missing data.
```{r}
pred<-predict(modFit, newdata=testing)
testing<-complete.cases(testing)
testing$predRight<- pred == testing$classe
table(pred,testing$classe)
```
This allows an estimate of out of sample error, which is c.25%

We should test now against the real test data.

```{r}
## now let's get the real test data
testurl<-'https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv'
download.file(trainurl,destfile="test.csv", method="curl")
test<-read.csv("test.csv" )
summary(test)
#removing the rownumbers, timestamps, window, and usernames as variables
testing2<-subset(test,select=-c(X,user_name,raw_timestamp_part_1,raw_timestamp_part_2,cvtd_timestamp,new_window,num_window))
# removing mostly NA data
few_na<-apply(!is.na(testing2),2,sum)>19621
testing2<-testing2[,few_na]
# comparing
pred2<-predict(modFit, newdata=testing2)
testing2<-complete.cases(testing2)
testing2$predRight<- pred == testing2$classe
table(pred2,testing2$classe)
```
This tells us our predictions were accurate in x out of y cases, or x%, meaning the out of sample error rate was 1-x%.

references:

Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM SIGCHI, 2013


